# ed-news

## Overview

This repository is a small static site generator and feed builder written in Python. It produces an `index.html` and an RSS feed from a collection of feeds and metadata. The project is organized as a package named `ednews` and a set of top-level scripts used to build and publish the site.

Most of this project was vibecoded with GitHub Copilot using GPT-5 mini.

## Current project layout

Top-level files and directories (important ones):

```
.
├── build.py                # Convenience build script (top-level)
├── main.py                 # CLI entry for building/serving
├── fetch.py                # Fetch helper script
├── calculate_vectors.py    # Utility for embedding/vector calculations
├── planet.json             # Sample site metadata
├── pyproject.toml          # Poetry/packaging config
├── ednews/                 # Main package
│   ├── __init__.py
│   ├── build.py            # core build logic used by scripts/tests
│   ├── config.py           # configuration helpers
│   ├── crossref.py         # CrossRef integration
│   ├── db.py               # simple DB helpers
│   ├── embeddings.py       # vector/embedding utilities
│   ├── feeds.py            # feed fetching/normalization
│   ├── sciencedirect.py    # ScienceDirect integration
│   └── ...
├── templates/              # Jinja2 templates used by the build
│   ├── index.html.jinja2
│   └── index.rss.jinja2
├── static/                 # Static assets included in the build
│   ├── main.css
│   └── main.js
├── build/                  # Output directory (generated by build)
│   └── ...
└── tests/                  # Test suite
    ├── test_build.py
    ├── test_crossref.py
    ├── test_crossref_integration.py
    ├── test_db_and_embeddings.py
    ├── test_doi_helpers.py
    └── test_feeds.py
    └── ...
```

Files in `ednews` correspond to small modules that the tests exercise. The top-level scripts (`build.py`, `main.py`, `fetch.py`) call into the package code.

## Setup

Create a virtual environment and activate it using `uv`:

```bash
uv sync
```

## Build and run

To generate the site output into the `build/` directory run the top-level build script:

```bash
uv run python build.py
```

You can also use the unified CLI entrypoint in `main.py`, which exposes several useful subcommands. Examples:

```bash
# Fetch feeds and save entries to the local DB
uv run python main.py fetch

# Render the static site (same as running build.py)
uv run python main.py build --out-dir build

# Generate embeddings and store them in the DB (optional model and batch size)
uv run python main.py embed --model <model-name> --batch-size 64

# Enrich articles by querying Crossref for missing metadata
uv run python main.py enrich-crossref --batch-size 20 --delay 0.1

# Lookup recent works for journals by ISSN and insert into DB
uv run python main.py issn-lookup --per-journal 30 --timeout 10 --delay 0.05
```

Tip: most `main.py` commands accept a global `-v/--verbose` flag to enable debug logging. Example:

```bash
# Run fetch with verbose logging
uv run python main.py -v fetch
```

There is also `ednews.build` which contains the core build logic and is exercised by tests. `main.py` provides a convenient CLI wrapper that calls into the package code.

The generated output will be placed in `build/` and includes `index.html`, `index.rss`, and a `static/` folder with assets.

Note: the build process now also copies the project's SQLite database (`ednews.db`, configured via `ednews.config.DB_PATH`) into the `build/` directory so the database is available alongside the generated site output.

## Tests

Run the test suite with pytest:

```bash
uv run pytest -q
```

Tests live in the `tests/` directory and include unit and integration tests for CrossRef, feeds, DB and embeddings helpers.

### CrossRef Tests

Enable CrossRef integration tests by setting the RUN_CROSSREF_INTEGRATION environment variable, then run the full test suite.

```bash
# persistent in current shell
export RUN_CROSSREF_INTEGRATION=1
uv run pytest -q

# or as a one-liner
RUN_CROSSREF_INTEGRATION=1 uv run pytest -q
```

## Contributing

Contributions welcome. Run tests before submitting PRs and follow the existing code style. If you add external integrations, include mocks or fixtures in `tests/fixtures` to keep test runs fast and hermetic.